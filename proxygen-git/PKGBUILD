# Maintainer: Daichi Shinozaki <dsdseg@gmail.com>
pkgname=proxygen-git
pkgver=r182.43f8ce9
pkgrel=1
pkgdesc="A collection of C++ HTTP libraries including an easy to use HTTP server"
arch=('i686' 'x86_64')
url="https://github.com/facebook/proxygen"
license=('Apache')
depends=('folly' 'fbthrift' 'libcap' 'gflags')
source=('git+https://github.com/facebook/proxygen.git' 
'EchoServer.cpp.patch')
makedepends=('git' 'autoconf-archive')
md5sums=('SKIP'
         'f587fd8970bd02648474dac6d9d62326')
_pkgname=${pkgname%-git}

pkgver() {
  cd "$srcdir/$_pkgname"
  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

prepare() {
  cd "$srcdir/$_pkgname/$_pkgname"
  autoreconf -ivf
  cd httpserver/samples/echo
  patch --verbose -p0 < $srcdir/EchoServer.cpp.patch
}

build() {
  cd "$srcdir/$_pkgname/$_pkgname"
  PYTHON=/usr/bin/python2 ./configure 
  make
}

package() {
  cd "$srcdir/$_pkgname/$_pkgname"
  make DESTDIR="$pkgdir/" install
}

# vim:set ts=2 sw=2 et:
